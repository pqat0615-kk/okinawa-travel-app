<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸŒŠ æ²–ç¹©è¼•æ—…è¡Œ - è‡ªå‹•å­˜æª”ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* é…è‰²ç³»çµ± */
        :root {
            --primary: #40A4E0;    /* ä¸»è—è‰² */
            --bg-light: #E0F7FF;   /* æ·ºè—èƒŒæ™¯ */
            --accent-pink: #FF88AA;
            --accent-green: #77DD77;
            --accent-yellow: #FFCC66;
            --accent-luggage: #9333EA; /* è¡Œæï¼šç´«è‰² */
            --weather-bg: #E3F2FD;
            --weather-text: #1565C0;
        }
        
        body { background-color: var(--bg-light); font-family: 'å¾®è»Ÿæ­£é»‘é«”', system-ui, sans-serif; color: #333; }

        /* Banner */
        .header-banner { height: 240px; position: relative; overflow: hidden; }
        .header-banner img { width: 100%; height: 100%; object-fit: cover; }
        .header-arc { position: absolute; bottom: -30px; left: 0; width: 100%; height: 60px; background: white; border-radius: 50% 50% 0 0; transform: scaleX(1.5); z-index: 10; }

        /* Nav */
        .nav-bar { position: absolute; bottom: 0; right: 1rem; transform: translateY(-50%); display: flex; gap: 10px; z-index: 20; }
        .nav-btn { background: white; border: none; padding: 12px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; color: #ccc; }
        .nav-btn.active { transform: scale(1.15); color: var(--primary); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .nav-btn.active.btn-info { color: var(--accent-pink); }
        .nav-btn.active.btn-shop { color: var(--accent-green); }
        .nav-btn.active.btn-money { color: var(--accent-yellow); }
        .nav-btn.active.btn-packing { color: var(--accent-luggage); } 

        /* Main */
        .main-container { background: white; min-height: calc(100vh - 200px); position: relative; z-index: 15; padding: 20px; padding-bottom: 80px; margin-top: -30px; }

        /* Tabs */
        .date-tabs { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; margin-bottom: 15px; border-bottom: 1px solid #eee; }
        .date-tab { flex: 0 0 auto; padding: 10px 10px; background: #f3f4f6; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; min-width: 90px; border: 2px solid transparent; }
        .date-tab.active { background: white; border-color: var(--primary); color: var(--primary); box-shadow: 0 4px 10px rgba(64, 164, 224, 0.2); }
        
        /* Weather */
        .weather-badge {
            margin-top: 6px;
            background-color: var(--weather-bg);
            color: var(--weather-text);
            padding: 4px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.2;
        }
        .weather-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* Card */
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; border-left: 4px solid var(--primary); position: relative; }
        .card.flight { border-left-color: #A78BFA; background: #F5F3FF; }
        .tag { display: inline-block; font-size: 12px; padding: 2px 8px; border-radius: 20px; color: white; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto bg-white min-h-screen relative shadow-2xl">

    <header class="header-banner">
        <img src="./okinawa_photo1.png" onerror="this.src='https://images.unsplash.com/photo-1511378730312-a6d68_60ea59b?q=80&w=1000&auto=format&fit=crop'" alt="æ²–ç¹©é¢¨æ™¯">
        <div class="header-arc"></div>
        <nav class="nav-bar">
            <button @click="currentTab = 'itinerary'" class="nav-btn" :class="{active: currentTab === 'itinerary'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            </button>
            <button @click="currentTab = 'info'" class="nav-btn btn-info" :class="{active: currentTab === 'info'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </button>
            <button @click="currentTab = 'shopping'" class="nav-btn btn-shop" :class="{active: currentTab === 'shopping'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            </button>
            <button @click="currentTab = 'packing'" class="nav-btn btn-packing" :class="{active: currentTab === 'packing'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-2 1m-2 2l-2 1m-2-1l-2-2H4a2 2 0 00-2 2v6a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/></svg>
            </button>
            <button @click="currentTab = 'expenses'" class="nav-btn btn-money" :class="{active: currentTab === 'expenses'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m-7-5h10M4 4h16a1 1 0 011 1v14a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z"/></svg>
            </button>
        </nav>
    </header>

    <main class="main-container">
        
        <div v-if="currentTab === 'itinerary'">
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-2xl font-bold text-gray-800">ğŸ—“ï¸ æ¯æ—¥è¡Œç¨‹</h2>
                <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">Open-Meteo å¤©æ°£</span>
            </div>
            <div class="date-tabs">
                <div v-for="(day, index) in days" :key="day.id" @click="selectedDayId = day.id" class="date-tab" :class="{active: selectedDayId === day.id}">
                    <div class="font-bold text-lg">{{ day.label }}</div>
                    <div class="text-xs opacity-70 mb-1">{{ day.date }}</div>
                    <div class="weather-badge">
                        <span class="weather-icon">{{ getDayWeather(index).icon }}</span>
                        <span class="font-bold">{{ getDayWeather(index).min }}~{{ getDayWeather(index).max }}Â°</span>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div v-for="item in currentItinerary" :key="item.id" class="card" :class="item.type">
                    <span class="tag" :style="{background: getTagColor(item.type)}">{{ getTagLabel(item.type) }}</span>
                    <div class="mt-1">
                        <h3 class="font-bold text-lg text-gray-800 flex items-center justify-between">
                            <span @click="searchMap(item.location)" class="cursor-pointer border-b-2 border-transparent hover:border-blue-400">{{ item.title }}</span>
                        </h3>
                        <div class="text-sm text-gray-600 mt-2 space-y-1">
                            <p v-if="item.time || item.transport" class="flex items-center text-blue-600 font-medium"><span class="mr-2">ğŸ•’ {{ item.time }}</span><span v-if="item.transport">ğŸšŒ {{ item.transport }}</span></p>
                            <p v-if="item.cost" class="text-red-500 font-bold">ğŸ’° {{ item.cost }}</p>
                            <p v-if="item.note" class="text-gray-500 bg-gray-50 p-2 rounded mt-1 whitespace-pre-line">ğŸ“ {{ item.note }}</p>
                        </div>
                    </div>
                </div>
                <div v-if="currentItinerary.length === 0" class="text-center py-10 text-gray-400">å°šç„¡è¡Œç¨‹è³‡æ–™</div>
            </div>
        </div>

        <div v-if="currentTab === 'info'">
            <h2 class="text-2xl font-bold text-pink-500 mb-4">â„¹ï¸ èˆªç­èˆ‡è³‡è¨Š</h2>
            <div class="space-y-4 mb-6">
                <div class="card flight">
                    <div class="flex justify-between items-center mb-2"><span class="bg-purple-200 text-purple-800 text-xs px-2 py-1 rounded font-bold">å»ç¨‹ 1/3 (å…­)</span><span class="font-bold text-purple-900">IT288</span></div>
                    <div class="flex justify-between text-xl font-black text-gray-700"><span>09:45 KHH</span><span>â†’</span><span>12:30 OKA</span></div>
                </div>
                <div class="card flight">
                    <div class="flex justify-between items-center mb-2"><span class="bg-purple-200 text-purple-800 text-xs px-2 py-1 rounded font-bold">å›ç¨‹ 1/6 (äºŒ)</span><span class="font-bold text-purple-900">SL391</span></div>
                    <div class="flex justify-between text-xl font-black text-gray-700"><span>11:50 OKA</span><span>â†’</span><span>12:40 KHH</span></div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-xl border-2 border-pink-200 shadow-sm">
                <h3 class="font-bold text-gray-700 mb-2">ğŸ’´ ç°¡æ˜“åŒ¯ç‡æ›ç®— (0.22)</h3>
                <div class="flex items-center space-x-2">
                    <input type="number" v-model="calcJpy" class="flex-1 border p-2 rounded text-lg outline-none" placeholder="æ—¥å¹£">
                    <span class="text-gray-400">=</span>
                    <div class="text-2xl font-extrabold text-pink-500 p-1 w-28 text-right">{{ (calcJpy * 0.22).toFixed(0) }}</div>
                    <span class="text-sm font-semibold text-gray-500">TWD</span>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-green-500">ğŸ›’ è³¼ç‰©æ¸…å–®</h2>
                <button @click="resetShopping" class="text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded">é‡ç½®é è¨­</button>
            </div>
            <div class="space-y-3 mb-8">
                <div v-for="(item, idx) in shoppingItems" :key="idx" class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-3 font-bold flex-shrink-0">{{ idx + 1 }}</div>
                        <span class="font-medium text-lg">{{ item }}</span>
                    </div>
                    <button @click="removeShopItem(idx)" class="p-2 text-gray-300 hover:text-red-500">ğŸ—‘ï¸</button>
                </div>
                <div v-if="shoppingItems.length === 0" class="text-center text-gray-400 py-6">æ¸…å–®æ˜¯ç©ºçš„</div>
            </div>
            <div class="mt-4 flex gap-2">
                <input type="text" v-model="newShopItem" @keyup.enter="addShopItem" placeholder="è¼¸å…¥æƒ³è²·çš„æ±è¥¿..." class="flex-1 p-2 border rounded focus:border-green-400 outline-none">
                <button @click="addShopItem" class="bg-green-500 text-white px-4 rounded font-bold shadow-md">+</button>
            </div>
        </div>

        <div v-if="currentTab === 'packing'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-purple-600">ğŸ’ éš¨èº«ç‰©å“æ¸…å–®</h2>
                <button @click="resetPacking" class="text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded">é‡ç½®é è¨­</button>
            </div>
            <div class="space-y-3 mb-8">
                <div v-for="(item, idx) in packingList" :key="item.id" class="flex items-center justify-between bg-purple-50 p-3 rounded-lg border border-purple-200">
                    <div class="flex items-center flex-1">
                         <div class="w-8 h-8 rounded-full bg-purple-200 text-purple-700 flex items-center justify-center mr-3 font-bold flex-shrink-0">{{ idx + 1 }}</div>
                        <span class="font-medium text-lg">{{ item.name }}</span>
                    </div>
                    <button @click="removePackingItem(item.id)" class="p-2 text-gray-300 hover:text-red-500">ğŸ—‘ï¸</button>
                </div>
                <div v-if="packingList.length === 0" class="text-center text-gray-400 py-6">æ¸…å–®æ˜¯ç©ºçš„</div>
            </div>
            <div class="bg-purple-100 p-4 rounded-xl border border-purple-300 shadow-sm">
                <div class="flex gap-2">
                    <input type="text" v-model="newPackName" @keyup.enter="addPackingItem" placeholder="ç‰©å“åç¨±" class="flex-1 p-2 border rounded border-purple-200 focus:border-purple-500 outline-none">
                    <button @click="addPackingItem" class="bg-purple-500 text-white font-bold py-2 px-4 rounded shadow-md">åŠ å…¥</button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'expenses'">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-yellow-500">ğŸ’° èŠ±è²»ç´€éŒ„</h2>
                <button @click="resetExpenses" class="text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded">é‡ç½®é è¨­</button>
            </div>
            <div class="bg-yellow-50 p-5 rounded-xl border border-yellow-300 text-center mb-6">
                <div class="text-sm text-gray-500 font-bold uppercase">Total Expenses</div>
                <div class="text-4xl font-black text-gray-800 mt-1">${{ totalExpense.toLocaleString() }}</div>
                <div class="text-xs text-gray-400">å°å¹£ (TWD)</div>
            </div>
            <div class="space-y-3 mb-8">
                <div v-for="(exp, idx) in expenseList" :key="exp.id" class="flex justify-between items-center bg-white p-3 border-b border-gray-100">
                    <div class="flex-1">
                        <div class="font-bold text-gray-700">{{ exp.name }}</div>
                        <div class="text-xs text-gray-400 px-1 bg-gray-100 inline-block rounded">{{ exp.cat }}</div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="font-bold text-lg text-gray-600">${{ exp.amount.toLocaleString() }}</div>
                        <button @click="removeExpense(idx)" class="text-gray-200 hover:text-red-500 text-sm p-1">âœ•</button>
                    </div>
                </div>
                <div v-if="expenseList.length === 0" class="text-center text-gray-400 py-6">æš«ç„¡èŠ±è²»ç´€éŒ„</div>
            </div>
            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 shadow-sm">
                <div class="flex flex-col gap-3">
                    <input type="text" v-model="newExpName" placeholder="é …ç›®åç¨±" class="p-2 border rounded border-yellow-200 outline-none">
                    <div class="flex gap-2">
                        <select v-model="newExpCat" class="p-2 border rounded border-yellow-200 bg-white w-24 text-sm">
                            <option value="é£Ÿ">é£Ÿ</option>
                            <option value="äº¤é€š">äº¤é€š</option>
                            <option value="è³¼ç‰©">è³¼ç‰©</option>
                            <option value="é–€ç¥¨">é–€ç¥¨</option>
                            <option value="ä½å®¿">ä½å®¿</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="number" v-model="newExpAmount" placeholder="é‡‘é¡ (å°å¹£)" class="flex-1 p-2 border rounded border-yellow-200 outline-none">
                    </div>
                    <button @click="addExpense" class="w-full bg-yellow-400 text-white font-bold py-2 rounded shadow-md">åŠ å…¥ç´€éŒ„</button>
                </div>
            </div>
        </div>
    </main>
    <div class="py-6"></div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const selectedDayId = ref('day1');
            const calcJpy = ref(1000);
            
            // --- é è¨­è³‡æ–™ (ä¾›é‡ç½®èˆ‡é¦–æ¬¡è¼‰å…¥ä½¿ç”¨) ---
            const defaultShopping = ['ç´…èŠ‹è›‹å¡”', 'é›ªé¹½é‡‘æ¥šç³•'];
            const defaultPacking = [
                { id: 101, name: 'è­·ç…§ (æœ‰æ•ˆ)' },
                { id: 102, name: 'æ—¥å¹£ç¾é‡‘/ä¿¡ç”¨å¡' },
                { id: 103, name: 'æ‰‹æ©Ÿ/å……é›»ç·š/è¡Œå‹•é›»æº' },
                { id: 104, name: 'è¼•ä¾¿å¤–å¥—' },
            ];
            const defaultExpenses = [
                { id: 1, name: 'æ©Ÿç¥¨ (å¾€è¿”)', amount: 27448, cat: 'äº¤é€š' },
                { id: 2, name: 'ä½å®¿è²»', amount: 10173, cat: 'ä½å®¿' },
                { id: 3, name: 'è³é¯¨èˆ¹ (å·²ä»˜)', amount: 4806, cat: 'é–€ç¥¨' },
                { id: 4, name: 'æ—…éŠSimå¡', amount: 1332, cat: 'å…¶ä»–' },
                { id: 5, name: 'æ—…éŠä¿éšª', amount: 864, cat: 'å…¶ä»–' },
                { id: 6, name: 'è¡Œæå¯„é€', amount: 439, cat: 'å…¶ä»–' },
            ];

            // --- éŸ¿æ‡‰å¼è³‡æ–™ ---
            const shoppingItems = ref([]);
            const newShopItem = ref('');
            const packingList = ref([]);
            const newPackName = ref('');
            const expenseList = ref([]);
            const newExpName = ref('');
            const newExpAmount = ref('');
            const newExpCat = ref('é£Ÿ'); 

            // --- LocalStorage è®€å–é‚è¼¯ ---
            // ç¨‹å¼å•Ÿå‹•æ™‚ï¼Œå˜—è©¦å¾æ‰‹æ©Ÿå„²å­˜ç©ºé–“è®€å–ã€‚å¦‚æœè®€ä¸åˆ°ï¼Œå°±ç”¨é è¨­å€¼ã€‚
            const loadData = () => {
                const savedShop = localStorage.getItem('okinawa_shopping_v1');
                if (savedShop) shoppingItems.value = JSON.parse(savedShop);
                else shoppingItems.value = [...defaultShopping];

                const savedPack = localStorage.getItem('okinawa_packing_v1');
                if (savedPack) packingList.value = JSON.parse(savedPack);
                else packingList.value = JSON.parse(JSON.stringify(defaultPacking));

                const savedExp = localStorage.getItem('okinawa_expenses_v1');
                if (savedExp) expenseList.value = JSON.parse(savedExp);
                else expenseList.value = JSON.parse(JSON.stringify(defaultExpenses));
            };

            // --- LocalStorage å­˜æª”é‚è¼¯ (Watchers) ---
            // åªè¦è³‡æ–™æœ‰è®Šå‹•ï¼Œé¦¬ä¸Šå­˜èµ·ä¾†
            watch(shoppingItems, (newVal) => {
                localStorage.setItem('okinawa_shopping_v1', JSON.stringify(newVal));
            }, { deep: true });

            watch(packingList, (newVal) => {
                localStorage.setItem('okinawa_packing_v1', JSON.stringify(newVal));
            }, { deep: true });

            watch(expenseList, (newVal) => {
                localStorage.setItem('okinawa_expenses_v1', JSON.stringify(newVal));
            }, { deep: true });

            // --- é‡ç½®åŠŸèƒ½ (é¸ç”¨) ---
            const resetShopping = () => { if(confirm('è¦æ¢å¾©é è¨­è³¼ç‰©æ¸…å–®å—ï¼Ÿ')) shoppingItems.value = [...defaultShopping]; };
            const resetPacking = () => { if(confirm('è¦æ¢å¾©é è¨­è¡Œææ¸…å–®å—ï¼Ÿ')) packingList.value = JSON.parse(JSON.stringify(defaultPacking)); };
            const resetExpenses = () => { if(confirm('è¦æ¢å¾©é è¨­èŠ±è²»ç´€éŒ„å—ï¼Ÿ')) expenseList.value = JSON.parse(JSON.stringify(defaultExpenses)); };


            // --- å…¶ä»–æ—¢æœ‰é‚è¼¯ ---
            const weatherList = ref([]); 
            const days = [
                { id: 'day1', label: 'Day 1', date: '1/3 (å…­)' }, { id: 'day2', label: 'Day 2', date: '1/4 (æ—¥)' },
                { id: 'day3', label: 'Day 3', date: '1/5 (ä¸€)' }, { id: 'day4', label: 'Day 4', date: '1/6 (äºŒ)' },
            ];
            const allItinerary = [
                { day: 'day1', type: 'flight', title: 'æŠµé”é‚£éœ¸ (IT288)', time: '12:30', location: 'Naha Airport', cost: null, transport: 'é£›æ©Ÿ', note: '9:45 é«˜é›„èµ·é£›' },
                { day: 'day1', type: 'other', title: 'æ©Ÿå ´å¯„è¡Œæ', time: '13:00', location: 'Naha Airport', cost: null, transport: 'æ­¥è¡Œ', note: 'åœ°é»: æ©Ÿå ´2F Before U Go (Â¥1000)' },
                { day: 'day1', type: 'sightseeing', title: 'iias æ²–ç¹©è±å´', time: '13:32', location: 'iias Okinawa Toyosaki', cost: 'æ°´æ—é¤¨Â¥2400', transport: '95è™Ÿ/TK01', note: 'DMMæ°´æ—é¤¨ã€é¤µè²“é ­é·¹' },
                { day: 'day1', type: 'food', title: 'ç€¨é•·å³¶ å¹¸ç¦é¬†é¤…', time: 'å‚æ™š', location: 'ç€¨é•·å³¶', cost: 'è»Šè³‡Â¥400', transport: 'TK01', note: 'âš ï¸ å…ˆæ‹¿è™Ÿç¢¼ç‰Œ' },
                { day: 'day1', type: 'food', title: 'æ™šé¤: ã‚­ãƒƒãƒãƒ³ ãƒ’ã‚«ãƒ«', time: 'æ™šä¸Š', location: 'åœ‹éš›é€š', cost: 'ç´„Â¥3000', transport: 'TK01', note: 'åœ‹éš›é€šä¸Šã€å±…é…’å±‹æ–™ç†' },
                { day: 'day2', type: 'other', title: 'é£¯åº—é›†åˆ', time: '07:30', location: 'Naha', cost: null, transport: null, note: 'æº–å‚™åƒåŠ è³é¯¨è¡Œç¨‹' },
                { day: 'day2', type: 'sightseeing', title: 'è³é¯¨èˆ¹é«”é©—', time: '08:00', location: 'é‚£éœ¸æ¸¯', cost: '$4806å·²ä»˜', transport: 'èˆ¹', note: 'KKdayé è¨‚ã€‚ä¸­åˆå›åˆ°é£¯åº—' },
                { day: 'day2', type: 'food', title: 'åˆé¤: æ•˜æ•˜è‹‘', time: '13:30', location: 'æ­Œç”ºç«™', cost: 'ç´„Â¥4000', transport: 'è¼•è»Œ', note: 'âš ï¸ å·²è¨‚ä½ 13:30' },
                { day: 'day2', type: 'shopping', title: 'Parco City é€›è¡—', time: 'ä¸‹åˆ', location: 'Parco City', cost: null, transport: 'å·´å£«/è¨ˆç¨‹è»Š', note: 'ä¸‹åˆè³¼ç‰©è¡Œç¨‹' },
                { day: 'day3', type: 'sightseeing', title: 'æ³¢ä¸Šå®®åƒæ‹œ', time: 'æ—©ä¸Š', location: 'Naminoue Shrine', cost: null, transport: 'æ­¥è¡Œ', note: '11:00é›¢é–‹æ­¥è¡Œè‡³ç¸£å»³' },
                { day: 'day3', type: 'other', title: 'LeaLea Lounge ç™¼è»Š', time: '12:45', location: 'LeaLea Lounge', cost: '$1512å·²ä»˜', transport: 'Bus', note: '12:30é›†åˆ' },
                { day: 'day3', type: 'sightseeing', title: 'ç¾åœ‹æ‘', time: 'ä¸‹åˆ', location: 'American Village', cost: null, transport: 'Bus', note: 'ğŸ„è–èª•ç‡ˆå…‰ç§€ (17-24é»)' },
                { day: 'day3', type: 'food', title: 'æ™šé¤: Steak 88', time: 'æ™šä¸Š', location: 'ç¾åœ‹æ‘', cost: 'ç´„Â¥4000', transport: null, note: 'ç¾å¼ç‰›æ’' },
                { day: 'day4', type: 'other', title: 'é€€æˆ¿ & æ©Ÿå ´åƒé£¯', time: 'æ—©ä¸Š', location: 'Naha Airport', cost: null, transport: 'è¼•è»Œ', note: 'æ•´ç†è¡Œæã€é€€æˆ¿' },
                { day: 'day4', type: 'flight', title: 'å›ç¨‹ é«˜é›„ (SL391)', time: '11:50', location: 'Naha Airport', cost: null, transport: 'é£›æ©Ÿ', note: '11:50 OKAèµ·é£› (*æ—¥æœ¬æ™‚é–“)' },
            ];

            const currentItinerary = computed(() => allItinerary.filter(item => item.day === selectedDayId.value));
            const totalExpense = computed(() => expenseList.value.reduce((sum, item) => sum + item.amount, 0));
            
            // Methods
            const addShopItem = () => { if(newShopItem.value) { shoppingItems.value.push(newShopItem.value); newShopItem.value=''; }};
            const removeShopItem = (i) => shoppingItems.value.splice(i, 1);
            const addPackingItem = () => { if(newPackName.value) { packingList.value.push({id:Date.now(), name:newPackName.value}); newPackName.value=''; }};
            const removePackingItem = (id) => packingList.value = packingList.value.filter(i => i.id !== id);
            const addExpense = () => { if(newExpName.value && newExpAmount.value) { expenseList.value.push({id:Date.now(), name:newExpName.value, amount:parseInt(newExpAmount.value), cat:newExpCat.value}); newExpName.value=''; newExpAmount.value=''; }};
            const removeExpense = (i) => expenseList.value.splice(i, 1);

            // Helpers
            const getTagColor = (t) => ({flight:'#A78BFA', food:'#F7A072', shopping:'#77DD77', sightseeing:'#40A4E0', other:'#9CA3AF'})[t] || '#ccc';
            const getTagLabel = (t) => ({flight:'èˆªç­', food:'ç¾é£Ÿ', shopping:'è³¼ç‰©', sightseeing:'æ™¯é»', other:'ç§»å‹•'})[t] || 'å…¶ä»–';
            const searchMap = (k) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(k + ' æ²–ç¹©')}`, '_blank');
            const getWeatherIconFromCode = (c) => (c<=1?'â˜€ï¸':c<=3?'â›…':c<=67?'ğŸŒ§ï¸':'ğŸŒ¥ï¸');
            const fetchWeatherData = async () => {
                try {
                    const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=26.2124&longitude=127.6809&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&forecast_days=7');
                    const data = await res.json();
                    if(data.daily) weatherList.value = data.daily.time.slice(0, 4).map((_, i) => ({
                        icon: getWeatherIconFromCode(data.daily.weather_code[i]),
                        max: Math.round(data.daily.temperature_2m_max[i]),
                        min: Math.round(data.daily.temperature_2m_min[i])
                    }));
                } catch (e) { weatherList.value = Array(4).fill({ icon: 'ğŸŒ¥ï¸', max: 20, min: 16 }); }
            };
            const getDayWeather = (i) => weatherList.value[i] || { icon: 'âŒ›', max: '-', min: '-' };

            onMounted(() => {
                loadData(); // è¼‰å…¥å­˜æª”
                fetchWeatherData();
            });

            return {
                currentTab, selectedDayId, days, currentItinerary, calcJpy,
                shoppingItems, newShopItem, addShopItem, removeShopItem, resetShopping,
                expenseList, newExpName, newExpAmount, newExpCat, totalExpense, addExpense, removeExpense, resetExpenses,
                packingList, newPackName, addPackingItem, removePackingItem, resetPacking,
                getTagColor, getTagLabel, searchMap, getDayWeather
            };
        }
    }).mount('#app');
</script>

</body>
</html>
