<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸŒŠ æ²–ç¹©è¼•æ—…è¡Œ - ç°¡åŒ–è¡Œææ¸…å–®ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* é…è‰²ç³»çµ± */
        :root {
            --primary: #40A4E0;    /* ä¸»è—è‰² */
            --bg-light: #E0F7FF;   /* æ·ºè—èƒŒæ™¯ */
            --accent-pink: #FF88AA;
            --accent-green: #77DD77;
            --accent-yellow: #FFCC66;
            --accent-luggage: #9333EA; /* è¡Œæï¼šç´«è‰² */
            --weather-bg: #E3F2FD;
            --weather-text: #1565C0;
        }
        
        body { background-color: var(--bg-light); font-family: 'å¾®è»Ÿæ­£é»‘é«”', system-ui, sans-serif; color: #333; }

        /* Banner */
        .header-banner { height: 240px; position: relative; overflow: hidden; }
        .header-banner img { width: 100%; height: 100%; object-fit: cover; }
        .header-arc { position: absolute; bottom: -30px; left: 0; width: 100%; height: 60px; background: white; border-radius: 50% 50% 0 0; transform: scaleX(1.5); z-index: 10; }

        /* Nav */
        .nav-bar { position: absolute; bottom: 0; right: 1rem; transform: translateY(-50%); display: flex; gap: 10px; z-index: 20; }
        .nav-btn { background: white; border: none; padding: 12px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s; color: #ccc; }
        .nav-btn.active { transform: scale(1.15); color: var(--primary); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .nav-btn.active.btn-info { color: var(--accent-pink); }
        .nav-btn.active.btn-shop { color: var(--accent-green); }
        .nav-btn.active.btn-money { color: var(--accent-yellow); }
        .nav-btn.active.btn-packing { color: var(--accent-luggage); } 

        /* Main */
        .main-container { background: white; min-height: calc(100vh - 200px); position: relative; z-index: 15; padding: 20px; padding-bottom: 80px; margin-top: -30px; }

        /* Date Tabs */
        .date-tabs { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; margin-bottom: 15px; border-bottom: 1px solid #eee; }
        .date-tab { flex: 0 0 auto; padding: 10px 10px; background: #f3f4f6; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; min-width: 90px; border: 2px solid transparent; }
        .date-tab.active { background: white; border-color: var(--primary); color: var(--primary); box-shadow: 0 4px 10px rgba(64, 164, 224, 0.2); }
        
        /* å¤©æ°£å°å¡æ¨£å¼ */
        .weather-badge {
            margin-top: 6px;
            background-color: var(--weather-bg);
            color: var(--weather-text);
            padding: 4px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.2;
        }
        .weather-icon { font-size: 1.5rem; margin-bottom: 2px; }

        /* Card */
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; border-left: 4px solid var(--primary); position: relative; }
        .card.flight { border-left-color: #A78BFA; background: #F5F3FF; }
        .tag { display: inline-block; font-size: 12px; padding: 2px 8px; border-radius: 20px; color: white; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto bg-white min-h-screen relative shadow-2xl">

    <header class="header-banner">
        <img src="okinawa_photo1.png" onerror="this.src='https://images.unsplash.com/photo-1596525166288-78248c826645?q=80&w=1000&auto=format&fit=crop'" alt="æ²–ç¹©">
        <div class="header-arc"></div>
        <nav class="nav-bar">
            <button @click="currentTab = 'itinerary'" class="nav-btn" :class="{active: currentTab === 'itinerary'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
            </button>
            <button @click="currentTab = 'info'" class="nav-btn btn-info" :class="{active: currentTab === 'info'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </button>
            <button @click="currentTab = 'shopping'" class="nav-btn btn-shop" :class="{active: currentTab === 'shopping'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
            </button>
            <button @click="currentTab = 'packing'" class="nav-btn btn-packing" :class="{active: currentTab === 'packing'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-2 1m-2 2l-2 1m-2-1l-2-2H4a2 2 0 00-2 2v6a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2z"/>
                </svg>
            </button>
            <button @click="currentTab = 'expenses'" class="nav-btn btn-money" :class="{active: currentTab === 'expenses'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m-7-5h10M4 4h16a1 1 0 011 1v14a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z"/></svg>
            </button>
        </nav>
    </header>

    <main class="main-container">
        
        <div v-if="currentTab === 'itinerary'">
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-2xl font-bold text-gray-800">ğŸ—“ï¸ æ¯æ—¥è¡Œç¨‹</h2>
                <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">
                    å¤©æ°£ä¾†æº: Open-Meteo
                </span>
            </div>
            
            <div class="date-tabs">
                <div v-for="(day, index) in days" :key="day.id" 
                     @click="selectedDayId = day.id"
                     class="date-tab"
                     :class="{active: selectedDayId === day.id}">
                    <div class="font-bold text-lg">{{ day.label }}</div>
                    <div class="text-xs opacity-70 mb-1">{{ day.date }}</div>
                    
                    <div class="weather-badge">
                        <span class="weather-icon">{{ getDayWeather(index).icon }}</span>
                        <span class="font-bold">{{ getDayWeather(index).min }}~{{ getDayWeather(index).max }}Â°</span>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="item in currentItinerary" :key="item.id" class="card" :class="item.type">
                    <span class="tag" :style="{background: getTagColor(item.type)}">{{ getTagLabel(item.type) }}</span>
                    <div class="mt-1">
                        <h3 class="font-bold text-lg text-gray-800 flex items-center justify-between">
                            <span @click="searchMap(item.location)" class="cursor-pointer border-b-2 border-transparent hover:border-blue-400">{{ item.title }}</span>
                        </h3>
                        <div class="text-sm text-gray-600 mt-2 space-y-1">
                            <p v-if="item.time || item.transport" class="flex items-center text-blue-600 font-medium">
                                <span class="mr-2">ğŸ•’ {{ item.time }}</span>
                                <span v-if="item.transport">ğŸšŒ {{ item.transport }}</span>
                            </p>
                            <p v-if="item.cost" class="text-red-500 font-bold">ğŸ’° {{ item.cost }}</p>
                            <p v-if="item.note" class="text-gray-500 bg-gray-50 p-2 rounded mt-1 whitespace-pre-line">ğŸ“ {{ item.note }}</p>
                        </div>
                    </div>
                </div>
                <div v-if="currentItinerary.length === 0" class="text-center py-10 text-gray-400">å°šç„¡è¡Œç¨‹è³‡æ–™</div>
            </div>
        </div>

        <div v-if="currentTab === 'info'">
            <h2 class="text-2xl font-bold text-pink-500 mb-4">â„¹ï¸ èˆªç­èˆ‡è³‡è¨Š</h2>
            <div class="space-y-4 mb-6">
                <div class="card flight">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-purple-200 text-purple-800 text-xs px-2 py-1 rounded font-bold">å»ç¨‹ 1/3</span>
                        <span class="font-bold">IT288</span>
                    </div>
                    <div class="flex justify-between text-xl font-black text-gray-700">
                        <span>09:45 KHH</span><span>â†’</span><span>12:30 OKA</span>
                    </div>
                </div>
                <div class="card flight">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-purple-200 text-purple-800 text-xs px-2 py-1 rounded font-bold">å›ç¨‹ 1/6</span>
                        <span class="font-bold">SL391</span>
                    </div>
                    <div class="flex justify-between text-xl font-black text-gray-700">
                        <span>11:50 OKA</span><span>â†’</span><span>12:40 KHH</span>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded-xl border-2 border-pink-200 shadow-sm">
                <h3 class="font-bold text-gray-700 mb-2">ğŸ’´ åŒ¯ç‡æ›ç®— (0.22)</h3>
                <div class="flex items-center space-x-2">
                    <input type="number" v-model="calcJpy" class="border p-2 rounded w-32 text-lg" placeholder="JPY">
                    <span class="text-2xl font-bold text-pink-500">= {{ (calcJpy * 0.22).toFixed(0) }}</span>
                    <span class="text-sm text-gray-500">TWD</span>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'">
            <h2 class="text-2xl font-bold text-green-500 mb-4">ğŸ›’ è³¼ç‰©æ¸…å–®</h2>
            <div class="space-y-3">
                <div v-for="(item, idx) in shoppingItems" :key="idx" 
                     class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-3 font-bold flex-shrink-0">
                            {{ idx + 1 }}
                        </div>
                        <span class="font-medium text-lg">{{ item }}</span>
                    </div>
                    <button @click="removeShopItem(idx)" class="p-2 text-gray-400 hover:text-red-500 transition-colors">ğŸ—‘ï¸</button>
                </div>
                <div v-if="shoppingItems.length === 0" class="text-center text-gray-400 py-4">
                    æ¸…å–®æ˜¯ç©ºçš„
                </div>
                <div class="mt-4 flex gap-2">
                    <input type="text" v-model="newShopItem" @keyup.enter="addShopItem" placeholder="è¼¸å…¥æƒ³è²·çš„æ±è¥¿..." class="flex-1 p-2 border rounded focus:border-green-400 outline-none">
                    <button @click="addShopItem" class="bg-green-500 text-white px-4 rounded font-bold shadow-md">+</button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'packing'">
            <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ’ éš¨èº«ç‰©å“æ¸…å–®</h2>
            
            <div class="space-y-3 mb-8">
                <div v-for="(item, idx) in packingList" :key="item.id" 
                     class="flex items-center justify-between bg-purple-50 p-3 rounded-lg border border-purple-200">
                    <div class="flex items-center flex-1">
                         <div class="w-8 h-8 rounded-full bg-purple-200 text-purple-700 flex items-center justify-center mr-3 font-bold flex-shrink-0">
                            {{ idx + 1 }}
                        </div>
                        <span class="font-medium text-lg">{{ item.name }}</span>
                    </div>
                    <button @click="removePackingItem(item.id)" class="p-2 text-gray-400 hover:text-red-500 transition-colors">ğŸ—‘ï¸</button>
                </div>
                <div v-if="packingList.length === 0" class="text-center text-gray-400 py-4">
                    æ¸…å–®æ˜¯ç©ºçš„ï¼Œè¨˜å¾—å¸¶é½Šæ±è¥¿å–”ï¼
                </div>
            </div>
            
            <div class="bg-purple-100 p-4 rounded-xl border border-purple-300 shadow-sm">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center">
                    <span class="bg-purple-500 w-2 h-6 mr-2 rounded"></span>
                    æ–°å¢ç‰©å“
                </h3>
                <div class="flex gap-2">
                    <input type="text" v-model="newPackName" @keyup.enter="addPackingItem"
                           placeholder="ç‰©å“åç¨± (ä¾‹å¦‚: è­·ç…§, è¼•ä¾¿é›¨è¡£)" 
                           class="flex-1 p-2 border rounded border-purple-200 focus:border-purple-500 outline-none">
                    
                    <button @click="addPackingItem" 
                            class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded shadow-md transition-colors">
                        åŠ å…¥
                    </button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'expenses'">
            <h2 class="text-2xl font-bold text-yellow-500 mb-4">ğŸ’° èŠ±è²»ç´€éŒ„</h2>
            
            <div class="bg-yellow-50 p-5 rounded-xl border border-yellow-300 text-center mb-6">
                <div class="text-sm text-gray-500 font-bold uppercase">Total Expenses</div>
                <div class="text-4xl font-black text-gray-800 mt-1">${{ totalExpense.toLocaleString() }}</div>
            </div>

            <div class="space-y-3 mb-8">
                <div v-for="(exp, idx) in expenseList" :key="exp.id" class="flex justify-between items-center bg-white p-3 border-b border-gray-100">
                    <div class="flex-1">
                        <div class="font-bold text-gray-700">{{ exp.name }}</div>
                        <div class="text-xs text-gray-400 px-1 bg-gray-100 inline-block rounded">{{ exp.cat }}</div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="font-bold text-lg text-gray-600">${{ exp.amount.toLocaleString() }}</div>
                        <button @click="removeExpense(idx)" class="text-gray-300 hover:text-red-500 text-sm">âœ•</button>
                    </div>
                </div>
                <div v-if="expenseList.length === 0" class="text-center text-gray-400 py-4">
                    æš«ç„¡èŠ±è²»ç´€éŒ„
                </div>
            </div>

            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 shadow-sm">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center">
                    <span class="bg-yellow-400 w-2 h-6 mr-2 rounded"></span>
                    æ–°å¢ä¸€ç­†
                </h3>
                <div class="flex flex-col gap-3">
                    <input type="text" v-model="newExpName" placeholder="é …ç›®åç¨± (ä¾‹å¦‚: ä¾¿åˆ©å•†åº—)" class="p-2 border rounded border-yellow-200 focus:border-yellow-500 outline-none">
                    
                    <div class="flex gap-2">
                        <select v-model="newExpCat" class="p-2 border rounded border-yellow-200 bg-white w-24 text-sm">
                            <option value="é£Ÿ">é£Ÿ</option>
                            <option value="äº¤é€š">äº¤é€š</option>
                            <option value="è³¼ç‰©">è³¼ç‰©</option>
                            <option value="é–€ç¥¨">é–€ç¥¨</option>
                            <option value="ä½å®¿">ä½å®¿</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                        <input type="number" v-model="newExpAmount" placeholder="é‡‘é¡" class="flex-1 p-2 border rounded border-yellow-200 focus:border-yellow-500 outline-none">
                    </div>

                    <button @click="addExpense" 
                            class="w-full bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 rounded shadow-md transition-colors">
                        åŠ å…¥ç´€éŒ„
                    </button>
                </div>
            </div>

        </div>

    </main>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const selectedDayId = ref('day1');
            const calcJpy = ref(1000);
            const newShopItem = ref('');
            const weatherList = ref([]); 

            // --- èŠ±è²»ç›¸é—œæ–°å¢è®Šæ•¸ ---
            const newExpName = ref('');
            const newExpAmount = ref('');
            const newExpCat = ref('é£Ÿ'); 

            // --- è¡Œææ¸…å–®æ–°å¢è®Šæ•¸ (ç°¡åŒ–ï¼Œç„¡éœ€ group) ---
            const newPackName = ref('');
            
            const days = [
                { id: 'day1', label: 'Day 1', date: '1/3 (å…­)' },
                { id: 'day2', label: 'Day 2', date: '1/4 (æ—¥)' },
                { id: 'day3', label: 'Day 3', date: '1/5 (ä¸€)' },
                { id: 'day4', label: 'Day 4', date: '1/6 (äºŒ)' },
            ];

            const allItinerary = [
                // Day 1
                { day: 'day1', type: 'flight', title: 'æŠµé”é‚£éœ¸ (IT288)', time: '12:30', location: 'Naha Airport', note: '9:45 KHH èµ·é£›' },
                { day: 'day1', type: 'move', title: 'æ©Ÿå ´å¯„è¡Œæ', time: '13:00', transport: 'æ­¥è¡Œ', location: 'Naha Airport', note: 'æ©Ÿå ´2F Before U Go' },
                { day: 'day1', type: 'spot', title: 'iias æ°´æ—é¤¨', time: '13:32', transport: '95è™Ÿ/TK01', cost: '$2220', location: 'iias Okinawa', note: 'é¤µè²“é ­é·¹' },
                { day: 'day1', type: 'food', title: 'ç€¨é•·å³¶ é¬†é¤…/è¦é£¯', time: 'ä¸‹åˆ', transport: 'Bus', cost: 'è»ŠÂ¥400', location: 'Umikaji Terrace', note: 'å…ˆæ‹¿è™Ÿç¢¼ç‰Œ' },
                { day: 'day1', type: 'food', title: 'æ™šé¤: åœ‹éš›é€š', time: 'æ™šä¸Š', transport: 'Bus', cost: 'ç´„Â¥3000', location: 'Kokusai Dori', note: 'å±…é…’å±‹ æˆ– ç‰§å¿—å¸‚å ´' },
                // Day 2
                { day: 'day2', type: 'spot', title: 'è³é¯¨èˆ¹', time: '08:00', transport: 'èˆ¹', cost: '$4806', location: 'Naha Port', note: 'KKday (12:45å›)' },
                { day: 'day2', type: 'food', title: 'æ•˜æ•˜è‹‘ (æ­Œç”ºç«™)', time: '13:30', transport: 'è¼•è»Œ', cost: 'ç´„Â¥4000', location: 'JoJoen Okinawa', note: 'å·²è¨‚ä½' },
                { day: 'day2', type: 'shop', title: 'Parco City / Aeon', time: 'ä¸‹åˆ', location: 'Parco City', note: 'é€›è¡—' },
                // Day 3
                { day: 'day3', type: 'spot', title: 'æ³¢ä¸Šå®®', time: 'æ—©ä¸Š', transport: 'æ­¥è¡Œ', location: 'Naminoue Shrine', note: '11:00 é›¢é–‹' },
                { day: 'day3', type: 'move', title: 'LeaLea Bus', time: '12:30', transport: 'Bus', cost: '$1512', location: 'LeaLea Lounge', note: 'ç¸£å»³å‰é›†åˆ' },
                { day: 'day3', type: 'spot', title: 'ç¾åœ‹æ‘', time: 'ä¸‹åˆ', location: 'American Village', note: 'è–èª•ç‡ˆå…‰ç§€' },
                { day: 'day3', type: 'food', title: 'æ™šé¤: Steak 88', time: 'æ™šé¤', cost: 'ç´„Â¥4000', location: 'Steak House 88', note: 'ç‰›æ’' },
                // Day 4
                { day: 'day4', type: 'move', title: 'é€€æˆ¿ & æ©Ÿå ´', time: 'æ—©ä¸Š', location: 'Naha Airport', note: 'æ©Ÿå ´åƒé£¯' },
                { day: 'day4', type: 'flight', title: 'å›ç¨‹ (SL391)', time: '11:50', location: 'Naha Airport', note: '12:40 æŠµé” KHH' },
            ];

            const shoppingItems = ref(['ç´…èŠ‹è›‹å¡”', 'é›ªé¹½é‡‘æ¥šç³•']);
            const expenseList = ref([
                { id: 1, name: 'æ©Ÿç¥¨', amount: 27448, cat: 'äº¤é€š' },
                { id: 2, name: 'ä½å®¿', amount: 10173, cat: 'ä½å®¿' },
                { id: 3, name: 'è³é¯¨èˆ¹', amount: 4806, cat: 'é–€ç¥¨' },
                { id: 4, name: 'Simå¡', amount: 1332, cat: 'ç¶²è·¯' },
                { id: 5, name: 'ä¿éšª', amount: 864, cat: 'ä¿éšª' },
                { id: 6, name: 'è¡Œæå¯„é€', amount: 439, cat: 'é›œæ”¯' },
            ]);

            // --- ç°¡åŒ–å¾Œçš„è¡Œææ¸…å–®æ•¸æ“š ---
            const packingList = ref([
                { id: 101, name: 'è­·ç…§' },
                { id: 102, name: 'æ—¥å¹£ç¾é‡‘' },
                { id: 103, name: 'æ‰‹æ©Ÿå……é›»ç·š/è¡Œå‹•é›»æº' },
                { id: 104, name: 'è¼•ä¾¿å¤–å¥—' },
            ]);


            const currentItinerary = computed(() => allItinerary.filter(i => i.day === selectedDayId.value));
            const totalExpense = computed(() => expenseList.value.reduce((s, i) => s + i.amount, 0));
            
            const getTagColor = (t) => ({flight:'#A78BFA', move:'#9CA3AF', spot:'#40A4E0', food:'#F7A072', shop:'#77DD77'})[t] || '#999';
            const getTagLabel = (t) => ({flight:'èˆªç­', move:'ç§»å‹•', spot:'æ™¯é»', food:'ç¾é£Ÿ', shop:'è³¼ç‰©'})[t] || 'å…¶ä»–';
            const searchMap = (k) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(k + ' æ²–ç¹©')}`, '_blank');
            
            // --- è³¼ç‰©æ¸…å–®é‚è¼¯ ---
            const addShopItem = () => { if(newShopItem.value) { shoppingItems.value.push(newShopItem.value); newShopItem.value=''; }};
            const removeShopItem = (index) => { shoppingItems.value.splice(index, 1); };

            // --- æ–°å¢èŠ±è²»é‚è¼¯ ---
            const addExpense = () => {
                if(newExpName.value && newExpAmount.value && newExpAmount.value > 0) {
                    expenseList.value.push({
                        id: Date.now(),
                        name: newExpName.value,
                        amount: parseInt(newExpAmount.value),
                        cat: newExpCat.value
                    });
                    newExpName.value = '';
                    newExpAmount.value = '';
                } else {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„åç¨±å’Œé‡‘é¡ï¼');
                }
            };
            const removeExpense = (index) => {
                if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†èŠ±è²»å—ï¼Ÿ')) {
                    expenseList.value.splice(index, 1);
                }
            };
            
            // --- ç°¡åŒ–å¾Œçš„è¡Œææ¸…å–®é‚è¼¯ ---
            const addPackingItem = () => {
                if(newPackName.value) {
                    packingList.value.push({
                        id: Date.now(),
                        name: newPackName.value,
                    });
                    newPackName.value = '';
                } else {
                    alert('è«‹è¼¸å…¥ç‰©å“åç¨±ï¼');
                }
            };
            const removePackingItem = (id) => {
                packingList.value = packingList.value.filter(item => item.id !== id);
            };


            // --- å¤©æ°£ API ---
            const getWeatherIcon = (code) => {
                if(code <= 1) return 'â˜€ï¸';
                if(code <= 3) return 'â›…';
                if(code <= 48) return 'ğŸŒ«ï¸';
                if(code <= 67) return 'ğŸŒ§ï¸';
                if(code <= 82) return 'â›ˆï¸';
                return 'ğŸŒ¥ï¸';
            };

            const fetchWeather = async () => {
                const url = 'https://api.open-meteo.com/v1/forecast?latitude=26.2124&longitude=127.6809&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&forecast_days=7';
                try {
                    const res = await fetch(url);
                    const data = await res.json();
                    if(data.daily && data.daily.time) {
                        weatherList.value = data.daily.time.slice(0, 4).map((_, i) => ({
                            icon: getWeatherIcon(data.daily.weather_code[i]),
                            max: Math.round(data.daily.temperature_2m_max[i]),
                            min: Math.round(data.daily.temperature_2m_min[i])
                        }));
                    }
                } catch (e) {
                    console.error("Weather API Error:", e);
                    weatherList.value = Array(4).fill({ icon: 'â›…', max: 20, min: 16 });
                }
            };
            const getDayWeather = (index) => weatherList.value[index] || { icon: 'âŒ›', max: '-', min: '-' };

            onMounted(fetchWeather);

            return {
                currentTab, selectedDayId, days, currentItinerary, totalExpense, expenseList, 
                shoppingItems, newShopItem, addShopItem, removeShopItem,
                newExpName, newExpAmount, newExpCat, addExpense, removeExpense, 
                // è¡Œææ¸…å–®ç›¸é—œ (å·²ç°¡åŒ–)
                packingList, newPackName, addPackingItem, removePackingItem,
                calcJpy, getTagColor, getTagLabel, searchMap, getDayWeather
            };
        }
    }).mount('#app');
</script>
</body>
</html>
