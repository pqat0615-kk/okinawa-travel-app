<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸŒŠ æ²–ç¹©è¼•æ—…è¡Œ - æ—¥ç³»æ¥µç°¡è¡Œç¨‹è¦åŠƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuedraggable/4.1.0/vuedraggable.umd.min.js"></script>

    <style>
        /* ğŸ¨ æ—¥ç³»æ¥µç°¡å¯æ„›é¢¨ / æ²–ç¹©æµ·æ´‹é¢¨æ ¼é…è‰²å®šç¾© */
        :root {
            --primary-blue: #66CCFF; /* ä¸»è‰²ï¼šæµ·æ´‹è— */
            --light-blue: #E0F7FF; /* 4. ç¶²é èƒŒæ™¯å»¶ä¼¸è‰² (æ¥µæ·ºè—) */
            --trip-date-bg: #40A4E0; /* è¼ƒæ·±çš„è—ï¼Œç”¨æ–¼æ—¥æœŸé¸ä¸­ */
        }
        
        /* 4. å°‡æ•´å€‹ç¶²é çš„èƒŒæ™¯é¡è‰²ä¾ç…§åœ–ç‰‡åº•è‰²åšå»¶ä¼¸ */
        body {
            background-color: var(--light-blue);
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* 3. é é¦– Banner å®¹å™¨ */
        .header-banner {
            height: 250px; /* åœ–ç‰‡å®¹å™¨é«˜åº¦ç‚º250 */
            position: relative;
        }

        /* 5. é é¦–åœ–ç‰‡èˆ‡ç™½åº•åœ“å¼§éŠœæ¥ */
        .header-arc {
            position: absolute;
            bottom: -50px; 
            left: 0;
            right: 0;
            height: 100px;
            background-color: white; 
            border-top-left-radius: 50%; 
            border-top-right-radius: 50%;
            transform: scaleX(1.5); /* è®“åœ“å¼§æ›´å¹³æ»‘åœ°å»¶ä¼¸ */
            z-index: 10;
        }

        /* 5. åˆ©ç”¨è² é‚Šè·å°‡ä¸‹æ–¹çš„ä¸»å…§å®¹å€åŸŸå‘ä¸Šæ‹‰å‹•é‡ç–Š */
        .main-content {
            margin-top: -50px; 
            position: relative;
            z-index: 20;
            background-color: white; 
            padding-top: 20px; 
            min-height: calc(100vh - 200px); 
        }

        /* 1. æ¯æ—¥è¡Œç¨‹è¡¨æ—¥æœŸé¸å–® - æ©«å‘æ»‘å‹•æ¨£å¼ */
        .date-scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            /* éš±è—æ»¾å‹•æ¢ */
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .date-scroll-container::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <div id="app" class="max-w-md mx-auto shadow-2xl bg-white min-h-screen">
        
        <header class="header-banner overflow-hidden relative">
            <img src="okinawa_photo1.png" alt="æ²–ç¹©æµ·æ´‹é¢¨æ™¯" class="w-full h-full object-cover">
            
            <div class="header-arc"></div>

            <nav class="absolute bottom-0 right-0 z-30 p-4 flex space-x-2 translate-y-1/2">
                <button @click="activeTab = 'itinerary'" class="p-3 bg-white rounded-full shadow-lg transition duration-300" :class="{'text-[var(--primary-blue)] scale-110 shadow-xl': activeTab === 'itinerary', 'text-gray-400': activeTab !== 'itinerary'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                </button>
                <button @click="activeTab = 'info'" class="p-3 bg-white rounded-full shadow-lg transition duration-300" :class="{'text-[var(--primary-blue)] scale-110 shadow-xl': activeTab === 'info', 'text-gray-400': activeTab !== 'info'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </button>
                <button @click="activeTab = 'shopping'" class="p-3 bg-white rounded-full shadow-lg transition duration-300" :class="{'text-[var(--primary-blue)] scale-110 shadow-xl': activeTab === 'shopping', 'text-gray-400': activeTab !== 'shopping'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </button>
                <button @click="activeTab = 'expenses'" class="p-3 bg-white rounded-full shadow-lg transition duration-300" :class="{'text-[var(--primary-blue)] scale-110 shadow-xl': activeTab === 'expenses', 'text-gray-400': activeTab !== 'expenses'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 10v-1m-7-5h10M4 4h16a1 1 0 011 1v14a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z"/></svg>
                </button>
            </nav>
        </header>

        <main class="main-content p-4 relative">
            
            <div v-show="activeTab === 'itinerary'">
                <h2 class="text-2xl font-extrabold text-[var(--primary-blue)] mb-4">ğŸ—“ï¸ æ¯æ—¥è¡Œç¨‹</h2>

                <div class="date-scroll-container pb-4 mb-4 border-b">
                    <div class="flex space-x-3">
                        <div v-for="day in days" :key="day.date" @click="selectedDate = day.date" 
                             class="flex-shrink-0 text-center p-3 rounded-xl cursor-pointer transition duration-300 shadow-md" 
                             :class="{'bg-[var(--trip-date-bg)] text-white scale-105': selectedDate === day.date, 'bg-gray-100 text-gray-500 hover:bg-gray-200': selectedDate !== day.date}">
                            <div class="text-lg font-bold">{{ day.dayOfWeek }}</div>
                            <div class="text-xs">{{ day.dateNumber }}</div>
                        </div>
                    </div>
                </div>
                
                <div v-if="weather" class="bg-blue-50 border-l-4 border-[var(--primary-blue)] p-4 mb-4 rounded-lg flex justify-between items-center shadow-inner">
                    <div class="flex items-center space-x-3">
                        <span class="text-3xl">{{ weather.icon }}</span> 
                        <span class="text-xl font-semibold text-gray-800">{{ weather.temperature }}Â°C</span>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">é«”æ„Ÿï¼š{{ weather.feelsLike }}Â°C</div>
                        <div class="text-xs text-gray-400">æ²–ç¹© é‚£éœ¸ (è‡ªå‹•æŠ“å–)</div>
                    </div>
                </div>

                <div class="mb-4">
                    <select v-model="filterCategory" class="w-full p-2 border border-gray-300 rounded-lg text-sm bg-white shadow-sm focus:ring-[var(--primary-blue)] focus:border-[var(--primary-blue)]">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                        <option value="sightseeing">æ™¯é»</option>
                        <option value="accommodation">ä½å®¿</option>
                        <option value="food">ç¾é£Ÿ</option>
                        <option value="shopping">è³¼ç‰©</option>
                        <option value="flight">èˆªç­</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                </div>

                <draggable v-model="filteredItinerary" item-key="id" tag="div" class="space-y-4">
                    <template #item="{ element: item, index }">
                        <div :class="{'opacity-50': item.type === 'flight'}" class="bg-white p-4 rounded-xl shadow-md border-l-4 border-gray-200 transition duration-300 hover:shadow-lg cursor-grab">
                            
                            <div v-if="item.transportation" class="flex items-center text-sm text-[var(--primary-blue)] mb-2">
                                <span class="mr-1">{{ transportationIcon(item.transportation) }}</span> 
                                <span>{{ item.travelTime }} ({{ item.transportation }})</span>
                            </div>

                            <div v-if="item.type === 'flight'" class="bg-[var(--light-blue)] p-3 rounded-lg border border-[var(--primary-blue)]">
                                <p class="font-bold text-lg text-[var(--trip-date-bg)] mb-1">âœˆï¸ {{ item.name }} ({{ item.flightNumber }})</p>
                                <p class="text-sm text-gray-600">ç‹€æ…‹ï¼š{{ flightInfo.status }}</p>
                                <div class="flex justify-between text-sm mt-1">
                                    <span>{{ item.departureAirport }} {{ item.departureTime }}</span>
                                    <span class="font-semibold text-gray-500">â†’</span>
                                    <span>{{ item.arrivalAirport }} {{ item.arrivalTime }}</span>
                                </div>
                            </div>

                            <div v-else class="flex justify-between items-start">
                                <div @click="openGoogleMaps(item.name)" class="flex-grow cursor-pointer active:opacity-75">
                                    <p class="text-lg font-bold text-gray-800">{{ item.name }}</p>
                                    <p v-if="item.openingHours" class="text-sm text-gray-600">ğŸ•˜ ç‡Ÿæ¥­ï¼š{{ item.openingHours }}</p>
                                    <p v-if="item.ticket" class="text-sm text-red-500">ğŸŸï¸ é–€ç¥¨ï¼š{{ item.ticket }}</p>
                                    <p v-if="item.notes" class="text-sm text-gray-500 mt-1">ğŸ“ å‚™è¨»ï¼š{{ item.notes }}</p>
                                </div>
                                <button @click="editItem(item)" class="text-gray-400 hover:text-[var(--primary-blue)] ml-4 flex-shrink-0 p-1 rounded-full hover:bg-gray-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-1.414 7.07l.707.707-2.828 2.828-.707-.707 2.828-2.828zM10 5a5 5 0 0110 0v10a5 5 0 01-10 0V5z" clip-rule="evenodd"/></svg>
                                </button>
                            </div>
                        </div>
                    </template>
                </draggable>

                <button @click="openAddModal('itinerary', 'add')" class="fixed bottom-4 right-4 p-4 bg-[var(--primary-blue)] text-white rounded-full shadow-xl hover:bg-blue-400 transition duration-300 z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
            </div>

            <div v-show="activeTab === 'info'">
                <h2 class="text-2xl font-extrabold text-[var(--primary-blue)] mb-6">â„¹ï¸ æ—…éŠè³‡è¨Š</h2>
                
                <div class="bg-blue-50 p-4 rounded-xl mb-6 border border-[var(--primary-blue)] shadow-md">
                    <h3 class="font-bold text-xl text-gray-700 mb-3">ğŸ’µ åŒ¯ç‡æ›ç®— (JPY â†’ TWD)</h3>
                    <div class="flex items-center space-x-2">
                        <input type="number" v-model.number="jpyAmount" placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡" class="w-1/2 p-2 border rounded-lg focus:ring-[var(--primary-blue)] focus:border-[var(--primary-blue)] text-lg">
                        <span class="text-xl font-semibold">JPY</span>
                    </div>
                    <div class="mt-3 text-3xl font-bold text-green-600">
                        = {{ twdAmount.toFixed(2) }} TWD
                    </div>
                    <p class="text-xs text-gray-400 mt-2">ï¼ˆä»¥ç•¶æ—¥åŒ¯ç‡ {{ exchangeRate }} è¨ˆç®—ï¼‰</p>
                </div>

                <div class="mb-6">
                    <h3 class="font-bold text-xl text-gray-700 mb-3">âœˆï¸ èˆªç­è³‡è¨Š (å‹•æ…‹æ¨¡æ“¬)</h3>
                    <div class="bg-gray-50 p-4 rounded-xl shadow-sm mb-3 border border-gray-200">
                        <p class="font-bold text-[var(--trip-date-bg)] mb-1">å»ç¨‹: {{ flightInfo.outbound.date }} ({{ flightInfo.status }})</p>
                        <p class="text-sm font-semibold">{{ flightInfo.outbound.flightNumber }}: {{ flightInfo.outbound.departureAirport }} {{ flightInfo.outbound.departureTime }} â†’ {{ flightInfo.outbound.arrivalAirport }} {{ flightInfo.outbound.arrivalTime }}</p>
                        <p class="text-xs text-gray-500">é£›è¡Œæ™‚é–“: {{ flightInfo.outbound.duration }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-xl shadow-sm border border-gray-200">
                        <p class="font-bold text-[var(--trip-date-bg)] mb-1">å›ç¨‹: {{ flightInfo.return.date }} ({{ flightInfo.status }})</p>
                         <p class="text-sm font-semibold">{{ flightInfo.return.flightNumber }}: {{ flightInfo.return.departureAirport }} {{ flightInfo.return.departureTime }} â†’ {{ flightInfo.return.arrivalAirport }} {{ flightInfo.return.arrivalTime }}</p>
                        <p class="text-xs text-gray-500">é£›è¡Œæ™‚é–“: {{ flightInfo.return.duration }}</p>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-xl text-gray-700 mb-3">ğŸ¨ ä½å®¿è³‡è¨Š</h3>
                    <div class="bg-gray-50 p-4 rounded-xl shadow-sm border border-gray-200">
                        <p class="font-bold text-[var(--primary-blue)] text-lg">{{ accommodation.name }}</p>
                        <p class="text-sm text-gray-700 mt-1">ğŸ“ é›»è©±: {{ accommodation.phone }}</p>
                        <p class="text-sm text-gray-700">ğŸ“ åœ°å€: {{ accommodation.address }}</p>
                        <a href="#" @click.prevent="openGoogleMaps(accommodation.name)" class="inline-flex items-center text-sm text-red-500 mt-2 hover:underline font-semibold">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                            é–‹å•Ÿå°èˆª
                        </a>
                    </div>
                </div>
            </div>

            <div v-show="activeTab === 'shopping'">
                <h2 class="text-2xl font-extrabold text-[var(--primary-blue)] mb-4">ğŸ›’ è³¼ç‰©æ¸…å–®</h2>

                <div class="space-y-3">
                    <div v-for="item in shoppingList" :key="item.id" class="flex items-center bg-gray-50 p-3 rounded-lg shadow-sm border border-gray-200">
                        <div class="w-12 h-12 bg-gray-200 rounded-lg mr-3 overflow-hidden flex items-center justify-center text-gray-400 text-xs">
                             <span v-if="!item.image">ğŸ“·</span>
                             <img v-else :src="item.image" alt="å•†å“åœ–ç‰‡" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-grow">
                            <p class="font-semibold text-gray-800">{{ item.name }}</p>
                        </div>
                        <button @click="deleteItem(item.id, 'shopping')" class="text-red-400 hover:text-red-600 p-1 rounded-full hover:bg-red-50">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                </div>

                <button @click="openAddModal('shopping', 'add')" class="fixed bottom-4 right-4 p-4 bg-[var(--primary-blue)] text-white rounded-full shadow-xl hover:bg-blue-400 transition duration-300 z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
            </div>

            <div v-show="activeTab === 'expenses'">
                <h2 class="text-2xl font-extrabold text-[var(--primary-blue)] mb-4">ğŸ’° èŠ±è²»ç´€éŒ„</h2>

                <div class="bg-red-50 p-4 rounded-xl mb-6 border border-red-400 text-center shadow-md">
                    <p class="text-sm font-semibold text-gray-600">ç¸½èŠ±è²» (JPY)</p>
                    <p class="text-3xl font-bold text-red-600">{{ totalExpenses.toLocaleString() }} JPY</p>
                    <p class="text-sm text-gray-500 mt-1">ç´„ {{ (totalExpenses * exchangeRate).toFixed(0).toLocaleString() }} TWD</p>
                </div>

                <div class="space-y-3">
                    <div v-for="expense in expenses" :key="expense.id" class="bg-gray-50 p-3 rounded-lg shadow-sm flex justify-between items-center border border-gray-200">
                        <div>
                            <p class="font-semibold text-gray-800">{{ expense.name }}</p>
                            <p class="text-xs text-gray-500">{{ expense.date }} | {{ expense.category }} ({{ expense.payment }})</p>
                             <p v-if="expense.notes" class="text-xs text-gray-400">å‚™è¨»: {{ expense.notes }}</p>
                        </div>
                        <p class="font-bold text-lg text-red-500">{{ expense.amount.toLocaleString() }} JPY</p>
                    </div>
                </div>

                <button @click="openAddModal('expenses', 'add')" class="fixed bottom-4 right-4 p-4 bg-[var(--primary-blue)] text-white rounded-full shadow-xl hover:bg-blue-400 transition duration-300 z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
            </div>
            
            <div v-if="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
                    <h3 class="text-xl font-bold text-[var(--primary-blue)] mb-4">
                        {{ modalTitle }}
                    </h3>
                    <p class="text-gray-600 mb-4 text-sm">æ­¤è™•ç‚ºæ¨¡æ…‹è¦–çª—å…§å®¹ï¼Œéœ€è¦å¯¦ä½œæ ¹æ“š **{{ modalContext }}** çš„è¡¨å–®è¼¸å…¥é‚è¼¯ã€‚</p>
                    
                    <button v-if="modalMode === 'edit'" @click="confirmDelete" class="w-full p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition duration-150 mb-2 font-semibold">
                        ğŸ—‘ï¸ åˆªé™¤ (éœ€ç¢ºèª)
                    </button>

                    <button @click="isModalOpen = false" class="w-full p-2 bg-gray-200 rounded-lg hover:bg-gray-300">é—œé–‰</button>
                </div>
            </div>

        </main>
    </div>

    <script>
        const { createApp, ref, computed } = Vue

        // å°‡ VueDraggable è¨»å†Šç‚ºçµ„ä»¶
        const Draggable = window.vuedraggable;

        createApp({
            components: { Draggable },
            setup() {
                const activeTab = ref('itinerary');
                const selectedDate = ref('2026-01-03'); 
                const isModalOpen = ref(false);
                const modalContext = ref(''); // åˆ¤æ–·æ˜¯å“ªå€‹åˆ†é çš„ Modal (itinerary, shopping, expenses)
                const modalMode = ref('add'); // 'add' or 'edit'
                const filterCategory = ref('');
                
                // --- æ•¸æ“šç‹€æ…‹ ---
                const exchangeRate = 0.2210; 
                const jpyAmount = ref(0);
                const twdAmount = computed(() => jpyAmount.value * exchangeRate);

                const flightInfo = ref({
                    status: 'æº–é»', // æ¨¡æ“¬èˆªç­å‹•æ…‹
                    outbound: { date: '2026/01/03', departureAirport: 'KHH', arrivalAirport: 'OKA', flightNumber: 'IT288', departureTime: '9:45', arrivalTime: '12:30', duration: '1å°æ™‚45åˆ†' },
                    return: { date: '2026/01/06', departureAirport: 'OKA', arrivalAirport: 'KHH', flightNumber: 'SL391', departureTime: '11:50', arrivalTime: '12:40', duration: '0å°æ™‚50åˆ†' },
                });
                
                const accommodation = ref({
                    name: 'Okinawa NaHaNa hotel&Spa',
                    phone: '+81-98-866-5151',
                    address: '2-3-1 Matsuo, Naha, Okinawa 900-0014 Japan',
                });
                
                const weather = ref({
                    icon: 'â˜€ï¸', 
                    temperature: 20, 
                    feelsLike: 22, 
                });

                // æ ¸å¿ƒè¡Œç¨‹æ•¸æ“š (Day1 èˆªç­å·²æ¨™è¨˜ type: 'flight')
                const itinerary = ref([
                    { id: 1, day: 'Day1', date: '2026-01-03', type: 'flight', name: 'èˆªç­è³‡è¨Š (KHHâ†’OKA)', flightNumber: 'IT288', departureTime: '9:45', arrivalTime: '12:30', departureAirport: 'KHH', arrivalAirport: 'OKA', travelTime: null, transportation: null, notes: 'è«‹å‹™å¿…æå‰å ±åˆ°' },
                    { id: 2, day: 'Day1', date: '2026-01-03', type: 'other', name: 'æ©Ÿå ´å¯„è¡Œæ (Before U Go)', openingHours: '10:00-19:00', ticket: null, notes: 'é‚£éœ¸æ©Ÿå ´2F, ã‚†ã„ã«ã¡ã‚¹ãƒˆãƒªãƒ¼ãƒˆ', travelTime: '15åˆ†', transportation: 'æ­¥è¡Œ' },
                    { id: 3, day: 'Day1', date: '2026-01-03', type: 'sightseeing', name: 'iias(DMMæ°´æ—é¤¨) / é¤µè²“é ­é·¹', openingHours: '10:00-21:00', ticket: 'å¤§äºº 2400 JPY', notes: 'æ­TK01/02 (13:32, 14:02)', travelTime: '20åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    { id: 4, day: 'Day1', date: '2026-01-03', type: 'food', name: 'ç€¨é•·å³¶ å¹¸ç¦é¬†é¤…', openingHours: '10:00-19:30', ticket: null, notes: 'å…ˆæ‹¿è™Ÿç¢¼ç‰Œ', travelTime: '15åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    { id: 5, day: 'Day1', date: '2026-01-03', type: 'food', name: 'æ²–ç¹©è¦è¦é£¯', openingHours: '11:00-21:00', ticket: null, notes: 'æ­TK01/02', travelTime: '10åˆ†', transportation: 'æ­¥è¡Œ' },
                    { id: 6, day: 'Day1', date: '2026-01-03', type: 'food', name: 'åœ‹éš›é€šæ™šé¤: yakiniku horumon nakama', openingHours: '17:00-23:00', ticket: null, notes: 'æ­TK01/02', travelTime: '30åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    
                    { id: 7, day: 'Day2', date: '2026-01-04', type: 'other', name: 'é£¯åº—é›†åˆ (è³é¯¨)', openingHours: '7:30', ticket: null, notes: '7:30é£¯åº—é›†åˆ', travelTime: '15åˆ†', transportation: 'æ­¥è¡Œ' }, // äº¤é€šæ™‚é–“ä»¥å‰ä¸€æ—¥ä½å®¿è¨ˆç®—
                    { id: 8, day: 'Day2', date: '2026-01-04', type: 'sightseeing', name: 'è³é¯¨èˆ¹', openingHours: '8:00å‡ºç™¼', ticket: '6000 JPY', notes: '13:00çµæŸ', travelTime: '25åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    { id: 9, day: 'Day2', date: '2026-01-04', type: 'food', name: 'ç¾åœ‹æ‘æ™šé¤: steak88', openingHours: '11:00-22:00', ticket: null, notes: 'ç¸£å»³æ­è»Š', travelTime: '45åˆ†', transportation: 'é–‹è»Š' },
                    
                    { id: 10, day: 'Day3', date: '2026-01-05', type: 'sightseeing', name: 'æ³¢ä¸Šå®®', openingHours: '9:00 (å¾¡å®ˆé–‹å§‹è²©è³£)', ticket: null, notes: 'å¾é£¯åº—æ­¥è¡Œ', travelTime: '15åˆ†', transportation: 'æ­¥è¡Œ' },
                    { id: 11, day: 'Day3', date: '2026-01-05', type: 'food', name: 'æ•˜æ•˜è‹‘ (æ­Œç”ºç«™)', openingHours: '12:15 (é ç´„)', ticket: null, notes: 'æ­¥è¡Œè‡³è¼•è»Œæ­åˆ°æ­Œç”ºç«™', travelTime: '30åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    { id: 12, day: 'Day3', date: '2026-01-05', type: 'shopping', name: 'Parco city', openingHours: '10:00-22:00', ticket: null, notes: null, travelTime: '15åˆ†', transportation: 'é–‹è»Š' },
                    { id: 13, day: 'Day3', date: '2026-01-05', type: 'shopping', name: 'Aeon mall', openingHours: '10:00-22:00', ticket: null, notes: null, travelTime: '10åˆ†', transportation: 'é–‹è»Š' },
                    
                    { id: 14, day: 'Day4', date: '2026-01-06', type: 'other', name: 'é›¢é–‹é£¯åº—å‰å¾€æ©Ÿå ´', openingHours: '9:00', ticket: null, notes: null, travelTime: '30åˆ†', transportation: 'å¤§çœ¾é‹è¼¸' },
                    { id: 15, day: 'Day4', date: '2026-01-06', type: 'flight', name: 'èˆªç­è³‡è¨Š (OKAâ†’KHH)', flightNumber: 'SL391', departureTime: '11:50', arrivalTime: '12:40', departureAirport: 'OKA', arrivalAirport: 'KHH', travelTime: null, transportation: null, notes: 'å»ºè­° 9:30 å‰æŠµé”æ©Ÿå ´' },
                ]);

                const shoppingList = ref([
                    { id: 1, name: 'ç´…èŠ‹è›‹å¡”', image: null },
                    { id: 2, name: 'é›ªé¹½é‡‘æ¥šç³•', image: null },
                ]);

                const expenses = ref([
                    { id: 1, category: 'æ©Ÿç¥¨', name: 'æ©Ÿç¥¨è²»ç”¨ (å¾€è¿”)', date: '2026-01-03', amount: 80000, payment: 'ä¿¡ç”¨å¡', notes: 'TWD 17680' },
                    { id: 2, category: 'ä½å®¿', name: 'é£¯åº—è²»ç”¨ (3æ™š)', date: '2026-01-03', amount: 35000, payment: 'ä¿¡ç”¨å¡', notes: null },
                    { id: 3, category: 'é£²é£Ÿ', name: 'åˆé¤ DMM æ°´æ—é¤¨', date: '2026-01-03', amount: 2500, payment: 'ç¾é‡‘', notes: null },
                    { id: 4, category: 'é–€ç¥¨', name: 'DMM æ°´æ—é¤¨é–€ç¥¨', date: '2026-01-03', amount: 2400, payment: 'ç¾é‡‘', notes: null },
                ]);

                // --- Computed å±¬æ€§ ---
                
                // æ ¹æ“šè¡Œç¨‹è³‡è¨Šç”Ÿæˆæ—¥æœŸé¸å–® (1. æ˜ŸæœŸï¼‹æ—¥æœŸ)
                const days = computed(() => {
                    const dateMap = {};
                    itinerary.value.forEach(item => {
                        if (!dateMap[item.date]) {
                            const dateObj = new Date(item.date);
                            dateMap[item.date] = {
                                date: item.date,
                                dayOfWeek: dateObj.toLocaleDateString('en-US', { weekday: 'short' }), // Fri
                                dateNumber: dateObj.getDate(), // 3, 4, 5, 6
                            };
                        }
                    });
                    return Object.values(dateMap).sort((a, b) => new Date(a.date) - new Date(b.date));
                });
                
                // ç¯©é¸ç•¶å‰é¸æ“‡æ—¥æœŸçš„è¡Œç¨‹ (åŒ…å« (2) åˆ†é¡ç¯©é¸)
                const filteredItinerary = computed({
                    get() {
                        let filtered = itinerary.value.filter(item => item.date === selectedDate.value);
                        if (filterCategory.value) {
                            filtered = filtered.filter(item => item.type === filterCategory.value);
                        }
                        return filtered;
                    },
                    set(newValue) {
                         // ç•¶ draggable æ”¹è®Šé †åºæ™‚ï¼Œæ›´æ–°åŸæ•¸æ“š (ç¢ºä¿æ‹–æ›³ç”Ÿæ•ˆ)
                         itinerary.value = itinerary.value.map(item => {
                            const updatedItem = newValue.find(ni => ni.id === item.id);
                            return updatedItem || item; // æ‰¾åˆ°å°±æ›¿æ›ï¼Œæ‰¾ä¸åˆ°ä¿æŒåŸæ¨£
                        });
                    }
                });


                // ç¸½èŠ±è²»è¨ˆç®—
                const totalExpenses = computed(() => {
                    return expenses.value.reduce((sum, item) => sum + item.amount, 0);
                });

                const modalTitle = computed(() => {
                    if (modalMode.value === 'add') {
                        if (modalContext.value === 'itinerary') return 'æ–°å¢è¡Œç¨‹';
                        if (modalContext.value === 'shopping') return 'æ–°å¢è³¼ç‰©æ¸…å–®é …ç›®';
                        if (modalContext.value === 'expenses') return 'æ–°å¢èŠ±è²»ç´€éŒ„';
                    }
                    if (modalMode.value === 'edit') {
                        return 'ç·¨è¼¯é …ç›® (å«åˆªé™¤)';
                    }
                    return 'æ“ä½œè¦–çª—';
                });

                // --- å‡½æ•¸ (Methods) ---
                
                // (6) äº¤é€šåœ–ç¤ºè¼”åŠ©å‡½æ•¸
                const transportationIcon = (type) => {
                    switch (type) {
                        case 'æ­¥è¡Œ': return 'ğŸš¶';
                        case 'é–‹è»Š': return 'ğŸš—';
                        case 'å¤§çœ¾é‹è¼¸': return 'ğŸšŒ';
                        default: return 'ğŸ“';
                    }
                }

                // (9) Google Maps å°èˆªåŠŸèƒ½
                const openGoogleMaps = (locationName) => {
                    // ä½¿ç”¨ Google Maps æŸ¥è©¢ URLï¼Œå¯¦ç¾é»æ“Šè·³è½‰åŠŸèƒ½
                    const encodedName = encodeURIComponent(locationName);
                    const mapUrl = `http://maps.google.com/?q=${encodedName}&travelmode=driving`;
                    window.open(mapUrl, '_blank');
                }

                // (3) å½ˆå‡ºè¦–çª—é–‹å•Ÿ
                const openAddModal = (context, mode = 'add') => { 
                    modalContext.value = context;
                    modalMode.value = mode;
                    isModalOpen.value = true;
                }
                const editItem = (item) => { 
                    // é€™è£¡éœ€è¦å°‡ item æ•¸æ“šè¼‰å…¥åˆ° modal å…§çš„è¡¨å–®ä¸­
                    modalContext.value = item.type; // åˆ¤æ–·è¡Œç¨‹é¡å‹
                    modalMode.value = 'edit';
                    isModalOpen.value = true; 
                }

                // (3) åˆªé™¤ç¢ºèªæ©Ÿåˆ¶
                const confirmDelete = () => {
                    if (confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤é …ç›®å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼')) {
                        // é€™è£¡éœ€è¦å¯¦ä½œå¯¦éš›çš„åˆªé™¤é‚è¼¯ï¼Œæ ¹æ“š modalContext å’Œç•¶å‰ç·¨è¼¯çš„é …ç›® ID é€²è¡Œåˆªé™¤
                        alert('é …ç›®å·²åˆªé™¤ (æ¨¡æ“¬)');
                        isModalOpen.value = false;
                    }
                }
                
                // æ¨¡æ“¬è³¼ç‰©æ¸…å–®åˆªé™¤ (ç°¡å–®ç‰ˆ)
                const deleteItem = (id, context) => {
                    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é …ç›®å—ï¼Ÿ')) {
                        if (context === 'shopping') {
                            shoppingList.value = shoppingList.value.filter(item => item.id !== id);
                        }
                        if (context === 'expenses') {
                             expenses.value = expenses.value.filter(item => item.id !== id);
                        }
                    }
                }

                return {
                    activeTab,
                    selectedDate,
                    isModalOpen,
                    modalContext,
                    modalMode,
                    modalTitle,
                    filterCategory,
                    days,
                    filteredItinerary,
                    shoppingList,
                    expenses,
                    totalExpenses,
                    exchangeRate,
                    jpyAmount,
                    twdAmount,
                    weather,
                    flightInfo,
                    accommodation,
                    transportationIcon,
                    openGoogleMaps,
                    openAddModal,
                    editItem,
                    confirmDelete,
                    deleteItem
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
